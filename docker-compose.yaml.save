version: "3.8"
services:
  mysqldatabase:
    image: mysql:5.7
    container_name: cm_mysql_database
    restart: always
    volumes:
        - ./mysql_data:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=helloworld123
      - MYSQL_DATABASE=communautevoyage
    ports:
      - ":3306"
    networks:
      - networkcustom

  symfony:
    container_name: cm_php_symfony
    build:
      context: .
    ports: 
      - '9000:9000'
    volumes: 
      - ./app:/var/www/symfony_docker
    depends_on:
      - mysqldatabase
    networks:
      - networkcustom

  nginx:
    container_name: cm_webserver_nginx
    image: nginx:stable-alpine
    ports:
      - '8080:80'
    volumes:
      - ./app:/var/www/symfony_docker
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - symfony
    networks:
      - networkcustom
#  elasticsearch:
#    image:  'docker.elastic.co/elasticsearch/elasticsearch:7.17.0'
#    container_name: cm_elasticsearch_database
#    restart: always
#    volumes:
#    - ./elasticsearch/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro,z
#    ports:
#      - "9200:9200"
#      - "9300:9300"
#    environment:
#      ES_JAVA_OPTS: "-Xmx256m -Xms256m"
#      ELASTIC_PASSWORD: changeme
#      discovery.type: single-node
#    networks:
#      - network

  # Pour tester les requÃªtes elastic on va utiliser kibana 
#  kibana:
#    image: 'docker.elastic.co/kibana/kibana:7.17.0'
#    container_name: kibana
#    hostname: kibana
#    restart: always
#    ports:
#      - '5601:5601'
#    depends_on:
#      - elasticsearch
#    networks:
#      - network
networks:
  networkcustom:
volumes:
    mysql_data:
